<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tarifler">
<title>Re√ßete & Tarif Defteri</title>
<link rel="apple-touch-icon" sizes="180x180" href="recete-tarif-defteri-icon.png">
<meta name="theme-color" content="#121212">
<style>
  :root{--bg:#121212;--card:#1e1e1e;--text:#fff;--muted:#bdbdbd;--accent:#4caf50;--line:#2a2a2a}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial;background:var(--bg);color:var(--text)}
  .app{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap}
  .title{font-weight:700;font-size:20px}
  .search{flex:1;min-width:260px;max-width:520px;display:flex;gap:8px;align-items:center;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px 10px}
  .search input{flex:1;border:0;outline:0;background:transparent;color:var(--text);font-size:14px}
  .btn{border:0;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;padding:10px 12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
  .btn.ghost{background:#2a2a2a}.btn.warn{background:#d32f2f}.btn.small{padding:6px 9px;font-weight:600}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .grid{display:grid;gap:14px;grid-template-columns:1fr}
  @media(min-width:960px){.grid{grid-template-columns:340px 1fr}}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px}
  .tagbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 10px}
  .chip{padding:6px 10px;border-radius:999px;background:#2a2a2a;border:1px solid var(--line);font-size:12px;cursor:pointer}
  .chip.active{background:var(--accent)}
  .list{display:flex;flex-direction:column;gap:10px;max-height:72vh;overflow:auto}
  .card{display:flex;gap:10px;background:#171717;border:1px solid var(--line);border-radius:12px;padding:10px;cursor:pointer}
  .thumb{width:64px;height:64px;border-radius:10px;object-fit:cover;background:#0f0f0f;border:1px solid #222}
  .meta{display:flex;flex-direction:column;gap:4px}.meta .name{font-weight:700}.meta .sub{color:var(--muted);font-size:12px}
  .detail{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;min-height:260px}
  .hero{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
  .hero img{width:120px;height:120px;border-radius:14px;object-fit:cover;background:#101010;border:1px solid #222}
  .h1{font-size:20px;font-weight:800;margin:0 0 6px}
  .muted{color:var(--muted);font-size:13px}
  .kvs{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px}
  .kv{background:#171717;border:1px solid var(--line);border-radius:10px;padding:6px 10px;font-size:12px}
  .section{margin-top:14px}.section h3{margin:0 0 8px;font-size:14px;font-weight:800}
  .inglist,.steplist{display:flex;flex-direction:column;gap:8px}
  .ing{display:flex;align-items:flex-start;gap:10px;background:#161616;border:1px solid #262626;border-radius:10px;padding:8px}
  .step{display:flex;gap:8px;background:#161616;border:1px solid #262626;border-radius:10px;padding:10px}
  .num{min-width:26px;height:26px;border-radius:7px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;font-weight:800}
  .empty{display:grid;place-items:center;min-height:240px;color:var(--muted);text-align:center}
  .modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.5);z-index:9999}
  .modal.open{display:flex}
  .sheet{background:var(--card);border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--line);width:100%;max-width:720px;padding:14px}
  @media(min-width:740px){.sheet{border-radius:16px;margin:40px;max-height:80vh;overflow:auto}.modal{align-items:center}}
  .row{display:flex;gap:10px;flex-wrap:wrap}.field{flex:1;min-width:200px;display:flex;flex-direction:column;gap:6px}
  label{font-size:12px;color:var(--muted)}
  input[type="text"],input[type="number"],input[type="file"],textarea{background:#141414;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:10px;font-size:14px;outline:none}
  textarea{min-height:90px;resize:vertical}
  .preview{width:100%;max-height:200px;object-fit:cover;border-radius:12px;border:1px solid #222;background:#0f0f0f}
  .diag{position:fixed;right:10px;bottom:10px;background:#2a2a2a;border:1px solid #333;color:#ddd;border-radius:20px;padding:6px 10px;font-size:12px;z-index:10000}
  .diag.good{background:#1b5e20}.diag.bad{background:#8e0000}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">üç≥ Re√ßete & Tarif Defteri</div>
    <div class="search">
      <input id="q" placeholder="Ara: tarif adƒ±, etiket, malzeme‚Ä¶">
      <button class="btn small ghost" id="clearSearch" type="button"
        onclick="document.getElementById('q').value=''; if(window.__renderList){window.__renderList();}">
        Temizle
      </button>
    </div>
    <div class="toolbar">
      <button class="btn small" id="addBtn" type="button"
        onclick="(function(){var m=document.getElementById('modal');m.classList.add('open');m.setAttribute('aria-hidden','false');setTimeout(function(){var x=document.getElementById('fName');if(x)x.focus();},50);} )()">
        + Yeni Tarif
      </button>
    </div>
  </header>

  <div class="grid">
    <div class="panel">
      <div class="muted">Etikete g√∂re filtrele:</div>
      <div id="tagBar" class="tagbar"></div>
      <div id="list" class="list"></div>
    </div>

    <div class="detail" id="detail">
      <div class="empty">Soldan bir tarif se√ßin ya da ‚Äú+ Yeni Tarif‚Äù ile ekleyin.</div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal" aria-hidden="true" onclick="if(event.target===this){this.classList.remove('open');this.setAttribute('aria-hidden','true');}">
  <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="h1" id="modalTitle">Yeni Tarif</div>
      <div class="toolbar">
        <button class="btn ghost small" id="closeModal" type="button"
          onclick="var m=document.getElementById('modal');m.classList.remove('open');m.setAttribute('aria-hidden','true');">
          Kapat
        </button>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="fName">Tarif Adƒ±</label>
        <input id="fName" type="text" placeholder="√ñrn: Fƒ±rƒ±nda Tavuk & Sebze">
      </div>
      <div class="field">
        <label for="fTags">Etiketler (virg√ºlle ayƒ±r)</label>
        <input id="fTags" type="text" placeholder="pratik, fƒ±rƒ±n, diyet">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="fServes">Porsiyon</label>
        <input id="fServes" type="number" min="1" step="1" placeholder="4">
      </div>
      <div class="field">
        <label for="fTime">S√ºre (dk)</label>
        <input id="fTime" type="number" min="0" step="5" placeholder="35">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="fIngs">Malzemeler (her satƒ±r bir madde)</label>
        <textarea id="fIngs" placeholder="2 adet tavuk g√∂ƒüs√º
1 kabak
1 kƒ±rmƒ±zƒ± biber
1 soƒüan
2 yemek ka≈üƒ±ƒüƒ± zeytinyaƒüƒ±
tuz, karabiber"></textarea>
      </div>
      <div class="field">
        <label for="fSteps">Adƒ±mlar (her satƒ±r bir adƒ±m)</label>
        <textarea id="fSteps" placeholder="Fƒ±rƒ±nƒ± 190¬∞C ƒ±sƒ±t.
Sebzeleri doƒüra.
Tavuklarƒ± doƒürayƒ±p baharatla karƒ±≈ütƒ±r.
Yaƒülanmƒ±≈ü tepsiye yay.
35 dk pi≈üir."></textarea>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="fPhoto">Kapak G√∂rseli (isteƒüe baƒülƒ±)</label>
        <input id="fPhoto" type="file" accept="image/*"
          onchange="(function(el){var f=el.files&&el.files[0];if(!f)return;var r=new FileReader();r.onload=function(){var p=document.getElementById('fPreview');p.src=r.result;p.style.display='block';};r.readAsDataURL(f);} )(this)">
        <img id="fPreview" class="preview" style="display:none" alt="">
      </div>
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button class="btn warn" id="deleteBtn" type="button" style="display:none"
        onclick="(function(){var m=document.getElementById('modal');var id=m.dataset.editId;if(!id)return;try{var db=JSON.parse(localStorage.getItem('tarifdefteri.v1')||'{}');db.recipes=(db.recipes||[]).filter(function(x){return x.id!==id});localStorage.setItem('tarifdefteri.v1',JSON.stringify(db));m.classList.remove('open');m.setAttribute('aria-hidden','true');location.reload();}catch(e){alert('Silme hatasƒ±')}})()">
        Sil
      </button>
      <button class="btn" id="saveBtn" type="button">Kaydet</button>
    </div>
  </div>
</div>

<div id="diag" class="diag" style="display:none" aria-hidden="true">Y√ºkleniyor‚Ä¶</div>

<script>
(function(){
  var diag = document.getElementById('diag');
  function $(s,root){return (root||document).querySelector(s)}
  var storeKey='tarifdefteri.v1';
  var data, activeId;
  var listEl=$('#list'), detailEl=$('#detail'), tagBar=$('#tagBar'), qInput=$('#q');
  var modal=$('#modal');
  var fName=$('#fName'), fTags=$('#fTags'), fServes=$('#fServes'), fTime=$('#fTime'),
      fIngs=$('#fIngs'), fSteps=$('#fSteps'), fPreview=$('#fPreview');

  var ok = !!listEl && !!detailEl && !!modal && !!fName;
  diag.textContent = ok ? 'Butonlar baƒülandƒ± ‚úì' : 'Baƒülama hatasƒ± ‚õî';
  diag.className = 'diag ' + (ok?'good':'bad');

  function uid(){ return Math.random().toString(36).slice(2,9) }
  function load(){
    try{ var raw=localStorage.getItem(storeKey); return raw? JSON.parse(raw): sample(); }
    catch(e){ return sample(); }
  }
  function save(){ localStorage.setItem(storeKey, JSON.stringify(data)) }
  function sample(){ return { recipes:[{
    id: uid(), name:"Fƒ±rƒ±nda Sebzeli Tavuk", tags:["pratik","fƒ±rƒ±n","ak≈üam"],
    serves:4, time:35, photo:"", ingredients:[
      {t:"2 adet tavuk g√∂ƒüs√º",done:false},{t:"1 kabak",done:false},{t:"1 kƒ±rmƒ±zƒ± biber",done:false},
      {t:"1 soƒüan",done:false},{t:"2 YK zeytinyaƒüƒ±",done:false},{t:"Tuz & karabiber",done:false}
    ], steps:["Fƒ±rƒ±nƒ± 190¬∞C ƒ±sƒ±t.","Sebzeleri ve tavuƒüu doƒüra.","Baharat ve yaƒüla karƒ±≈ütƒ±r.","Tepsiye yay, 35 dk pi≈üir."],
    created:Date.now(), updated:Date.now()
  }]}; }
  function esc(s){ return String(s||'').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }
  function allTags(){ var s={}, out=[], i; for(i=0;i<data.recipes.length;i++){var r=data.recipes[i], j, tags=r.tags||[]; for(j=0;j<tags.length;j++){s[tags[j]]=1}} for(i in s){out.push(i)} out.sort(); return out; }
  var tagFilter=null;

  function renderTagBar(){
    tagBar.innerHTML='';
    var any=document.createElement('div'); any.className='chip'+(tagFilter===null?' active':''); any.textContent='T√ºm√º';
    any.onclick=function(){ tagFilter=null; renderAll(); };
    tagBar.appendChild(any);
    var tags=allTags(); for(var i=0;i<tags.length;i++){
      (function(t){
        var el=document.createElement('div'); el.className='chip'+(tagFilter===t?' active':''); el.textContent=t;
        el.onclick=function(){ tagFilter=(tagFilter===t?null:t); renderAll(); };
        tagBar.appendChild(el);
      })(tags[i]);
    }
  }

  function matches(r,q){
    if(!q) return true; q=q.toLowerCase();
    if((r.name||'').toLowerCase().indexOf(q)>-1) return true;
    if((r.tags||[]).join(' ').toLowerCase().indexOf(q)>-1) return true;
    var ings=r.ingredients||[];
    for(var i=0;i<ings.length;i++){ if((ings[i].t||'').toLowerCase().indexOf(q)>-1) return true; }
    return false;
  }

  function renderList(){
    var q=qInput.value.trim();
    var items=(data.recipes||[]).slice().filter(function(r){
      return (tagFilter ? (r.tags||[]).indexOf(tagFilter)>-1 : true) && matches(r,q);
    }).sort(function(a,b){ return b.updated - a.updated; });

    listEl.innerHTML='';
    if(items.length===0){ listEl.innerHTML='<div class="muted">Sonu√ß yok.</div>'; return; }
    for(var i=0;i<items.length;i++){
      (function(r){
        var card=document.createElement('div'); card.className='card';
        var img=document.createElement('img'); img.className='thumb';
        img.src=r.photo||'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect width="100%" height="100%" fill="%23101010"/><text x="50%" y="55%" font-family="Arial" font-size="10" fill="%23333" text-anchor="middle">FOTO</text></svg>';
        var meta=document.createElement('div'); meta.className='meta';
        meta.innerHTML='<div class="name">'+esc(r.name)+'</div><div class="sub">'+(r.tags||[]).map(function(t){return '#'+t}).join(' ')+' ‚Ä¢ '+(r.time||'-')+' dk ‚Ä¢ '+(r.serves||'-')+' porsiyon</div>';
        card.appendChild(img); card.appendChild(meta);
        card.onclick=function(){ activeId=r.id; renderDetail(); };
        listEl.appendChild(card);
      })(items[i]);
    }
  }

  function renderDetail(){
    var r=null, i;
    for(i=0;i<data.recipes.length;i++){ if(data.recipes[i].id===activeId){ r=data.recipes[i]; break; } }
    if(!r){ detailEl.innerHTML='<div class="empty">Soldan bir tarif se√ßin ya da ‚Äú+ Yeni Tarif‚Äù.</div>'; return; }

    var ingHTML='', ings=r.ingredients||[];
    for(i=0;i<ings.length;i++){ ingHTML+= '<label class="ing"><input type="checkbox" data-ing="'+i+'" '+(ings[i].done?'checked':'')+'><div>'+esc(ings[i].t)+'</div></label>'; }
    var stepsHTML='', steps=r.steps||[];
    for(i=0;i<steps.length;i++){ stepsHTML+= '<div class="step"><div class="num">'+(i+1)+'</div><div>'+esc(steps[i])+'</div></div>'; }

    var photo = r.photo||'data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;120&quot; height=&quot;120&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;%23101010&quot;/><text x=&quot;50%&quot; y=&quot;55%&quot; font-family=&quot;Arial&quot; font-size=&quot;12&quot; fill=&quot;%23333&quot; text-anchor=&quot;middle&quot;>FOTO</text></svg>';

    detailEl.innerHTML =
      '<div class="hero">'+
      '  <img src="'+photo+'">'+
      '  <div class="info">'+
      '    <h2 class="h1">'+esc(r.name)+'</h2>'+
      '    <div class="muted">Etiketler: '+((r.tags||[]).map(function(t){return "#"+t}).join(" ")||"‚Äî")+'</div>'+
      '    <div class="kvs"><div class="kv">‚è± '+(r.time||"-")+' dk</div><div class="kv">üë• '+(r.serves||"-")+' porsiyon</div><div class="kv">üóì '+(new Date(r.updated)).toLocaleDateString()+'</div></div>'+
      '    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">'+
      '      <button class="btn small" id="editBtn" type="button">D√ºzenle</button>'+
      '      <button class="btn small ghost" id="dupBtn" type="button">Kopya Olu≈ütur</button>'+
      '      <button class="btn small warn" id="delBtn" type="button">Sil</button>'+
      '    </div>'+
      '  </div>'+
      '</div>'+
      '<div class="section"><h3>Malzemeler</h3><div class="inglist" id="ingList">'+ingHTML+'</div></div>'+
      '<div class="section"><h3>Adƒ±mlar</h3><div class="steplist">'+stepsHTML+'</div></div>';

    var ingListEl = document.getElementById('ingList');
    if(ingListEl){
      ingListEl.addEventListener('change', function(e){
        var t = e.target || e.srcElement;
        var idx = parseInt(t.getAttribute('data-ing'),10);
        if(!isNaN(idx) && ings[idx]){ ings[idx].done = !!t.checked; r.updated=Date.now(); save(); }
      });
    }

    var editBtn=document.getElementById('editBtn');
    if(editBtn){
      editBtn.addEventListener('click', function(){
        document.getElementById('modalTitle').textContent='Tarifi D√ºzenle';
        document.getElementById('deleteBtn').style.display='inline-flex';
        modal.dataset.editId=r.id;
        fName.value=r.name||''; fTags.value=(r.tags||[]).join(', '); fServes.value=r.serves||''; fTime.value=r.time||'';
        fIngs.value=(r.ingredients||[]).map(function(i){return i.t}).join('\n'); fSteps.value=(r.steps||[]).join('\n');
        if(r.photo){ fPreview.src=r.photo; fPreview.style.display='block'; } else { fPreview.src=''; fPreview.style.display='none'; }
        modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
        setTimeout(function(){ fName.focus(); },50);
      });
    }

    var dupBtn=document.getElementById('dupBtn');
    if(dupBtn){
      dupBtn.addEventListener('click', function(){
        var c = JSON.parse(JSON.stringify(r)); c.id=uid(); c.name=r.name+' (Kopya)'; c.created=c.updated=Date.now();
        data.recipes.unshift(c); save(); renderAll(); activeId=c.id; renderDetail();
      });
    }

    var delBtn=document.getElementById('delBtn');
    if(delBtn){
      delBtn.addEventListener('click', function(){
        if(!confirm('Bu tarifi silmek istiyor musunuz?')) return;
        var arr=[]; for(var i=0;i<data.recipes.length;i++){ if(data.recipes[i].id!==r.id) arr.push(data.recipes[i]); }
        data.recipes=arr; save(); renderAll(); activeId=data.recipes[0]?data.recipes[0].id:null; renderDetail();
      });
    }
  }

  function openModal(id){
    document.getElementById('modalTitle').textContent = id ? 'Tarifi D√ºzenle' : 'Yeni Tarif';
    document.getElementById('deleteBtn').style.display = id ? 'inline-flex' : 'none';
    if(id){
      var r=null; for(var i=0;i<data.recipes.length;i++){ if(data.recipes[i].id===id){ r=data.recipes[i]; break; } }
      if(r){
        fName.value=r.name||''; fTags.value=(r.tags||[]).join(', '); fServes.value=r.serves||''; fTime.value=r.time||'';
        fIngs.value=(r.ingredients||[]).map(function(i){return i.t}).join('\n'); fSteps.value=(r.steps||[]).join('\n');
        if(r.photo){ fPreview.src=r.photo; fPreview.style.display='block'; } else { fPreview.src=''; fPreview.style.display='none'; }
        modal.dataset.editId=id;
      }
    }else{
      modal.dataset.editId='';
      fName.value=''; fTags.value=''; fServes.value=''; fTime.value=''; fIngs.value=''; fSteps.value='';
      fPreview.src=''; fPreview.style.display='none';
    }
    modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
    setTimeout(function(){ fName.focus(); },50);
  }

  function closeModal(){
    modal.classList.remove('open'); modal.setAttribute('aria-hidden','true');
  }

  function handleSave(){
    var name=fName.value.trim();
    if(!name){ alert('Tarif adƒ± gerekli.'); fName.focus(); return; }
    var tags=(fTags.value||'').split(','); var cleanTags=[]; for(var i=0;i<tags.length;i++){ var t=tags[i].trim(); if(t) cleanTags.push(t.toLowerCase()); }
    var serves=parseInt(fServes.value,10)||null, time=parseInt(fTime.value,10)||null;
    var ingredients=(fIngs.value||'').split('\n'); var ingArr=[]; for(i=0;i<ingredients.length;i++){ var s=ingredients[i].trim(); if(s) ingArr.push({t:s,done:false}); }
    var steps=(fSteps.value||'').split('\n'); var stepArr=[]; for(i=0;i<steps.length;i++){ var st=steps[i].trim(); if(st) stepArr.push(st); }
    var photo=(fPreview && fPreview.style.display!=='none' && fPreview.src) ? fPreview.src : '';

    var id=modal.dataset.editId||'';
    if(id){
      for(i=0;i<data.recipes.length;i++){
        if(data.recipes[i].id===id){
          var prevIngs = data.recipes[i].ingredients||[];
          var merged=[]; for(var k=0;k<ingArr.length;k++){ 
            var found=false, done=false;
            for(var p=0;p<prevIngs.length;p++){ if(prevIngs[p].t===ingArr[k].t){ done=prevIngs[p].done; found=true; break; } }
            merged.push({t:ingArr[k].t, done:done});
          }
          data.recipes[i].name=name; data.recipes[i].tags=cleanTags; data.recipes[i].serves=serves; data.recipes[i].time=time;
          data.recipes[i].ingredients=merged; data.recipes[i].steps=stepArr; data.recipes[i].photo=photo; data.recipes[i].updated=Date.now();
          activeId=data.recipes[i].id; break;
        }
      }
    }else{
      var rec={id:uid(),name:name,tags:cleanTags,serves:serves,time:time,ingredients:ingArr,steps:stepArr,photo:photo,created:Date.now(),updated:Date.now()};
      data.recipes.unshift(rec); activeId=rec.id;
    }
    save(); closeModal(); renderAll(); renderDetail();
  }

  // Fallback: inline "Kaydet" √ßaƒüƒ±rƒ±rsa kullanƒ±lsƒ±n
  window.__fallbackSave = handleSave;
  window.__renderList = renderList;

  // Bind
  var addBtn=document.getElementById('addBtn'); if(addBtn){ addBtn.addEventListener('click', function(){ openModal(null); }); }
  var closeBtn=document.getElementById('closeModal'); if(closeBtn){ closeBtn.addEventListener('click', closeModal); }
  var saveBtn=document.getElementById('saveBtn'); if(saveBtn){ saveBtn.addEventListener('click', handleSave); }
  modal.addEventListener('click', function(e){ if(e.target===modal){ closeModal(); } });

  var printBtn=document.getElementById('printBtn'); if(printBtn){ printBtn.addEventListener('click', function(){ window.print(); }); }
  var exportBtn=document.getElementById('exportBtn'); if(exportBtn){ exportBtn.addEventListener('click', function(){
    try{ var raw=localStorage.getItem(storeKey)||'{}'; var b=new Blob([raw],{type:'application/json'}); var a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='tarifler.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(function(){URL.revokeObjectURL(a.href)},1500); }catch(e){ alert('Dƒ±≈üa aktarma hatasƒ±'); }
  }); }
  var importFile=document.getElementById('importFile'); if(importFile){ importFile.addEventListener('change', function(e){
    var f=e.target.files&&e.target.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ try{ var o=JSON.parse(r.result); if(o && o.recipes && o.recipes.splice){ data=o; save(); renderAll(); activeId=data.recipes[0]?data.recipes[0].id:null; renderDetail(); } else alert('Ge√ßersiz dosya formatƒ±.'); }catch(err){ alert('JSON okunamadƒ±.'); } }; r.readAsText(f);
  }); }
  if(qInput){ qInput.addEventListener('input', renderList); }
  var clearBtn=document.getElementById('clearSearch'); if(clearBtn){ clearBtn.addEventListener('click', function(){ qInput.value=''; renderList(); }); }

  // Start
  data = load();
  activeId = data.recipes[0] ? data.recipes[0].id : null;
  function renderAll(){ renderTagBar(); renderList(); }
  renderAll(); renderDetail();

})();
</script>
<script src="app.js?v=hide1"></script>
</body>
</html>
